name: Deploy with Docker Compose

on:
  push:
    branches: [ "main" ]
  workflow_dispatch:

jobs:
  create-docker-image:
    runs-on: ubuntu-latest     
    steps:         
      - name: ssh into server
        run: |
            #sshpass -p ${{ secrets.PASS_SERVER }} ssh -o StrictHostKeyChecking=no ${{ secrets.AUTH_SERVER }} << EOF   
            sshpass -p ${{ secrets.PASS_SERVER }} scp -o StrictHostKeyChecking=no -r ./ ${{ secrets.AUTH_SERVER }}:/root/proyect << EOF
              cd /root/proyect
              #scp -r ./* ${{ secrets.AUTH_SERVER }}:/home/ubuntu/proyecto
              # Opcional: parar contenedores existentes
              sudo docker-compose down || true

              # Levantar contenedores segÃºn docker-compose.yml
              sudo docker-compose up -d
            EOF
            
