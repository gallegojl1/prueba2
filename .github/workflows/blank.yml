name: Deploy with Docker Compose

on:
  push:
    branches: [ "main" ]
  workflow_dispatch:

jobs:
  create-docker-image:
    runs-on: ubuntu-latest     
    steps:         
        - name: Copy project files to server
          run: |
            sshpass -p ${{ secrets.PASS_SERVER }} scp -o StrictHostKeyChecking=no -r ./ ${{ secrets.AUTH_SERVER }}:/root/proyect
        
        - name: Deploy with Docker Compose
          run: |
            sshpass -p ${{ secrets.PASS_SERVER }} ssh -o StrictHostKeyChecking=no ${{ secrets.AUTH_SERVER }} << 'EOF'
              cd /root/proyect
              ls -la   # para comprobar que los archivos estÃ¡n
              sudo docker-compose down || true   # parar si hay algo previo
              sudo docker-compose up -d --build
            EOF
            
