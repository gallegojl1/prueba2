name: Deploy with Docker Compose

on:
  push:
    branches: [ "main" ]
  workflow_dispatch:

jobs:
  create-docker-image:
    runs-on: ubuntu-latest     
    steps:         
      - name: Checkout code
        uses: actions/checkout@v4

      - name: Copy file via SSH password
        uses: appleboy/scp-action@v1
        with:
          host: 217.160.88.215
          username: root
          password: 02qHfCw9
          port: 22
          source: "."
          target: /root/proyect

      # Ejecutar docker-compose en el servidor
      - name: Desplegar con Docker Compose
        uses: appleboy/ssh-action@master
        with:
          host: 217.160.88.215
          username: root
          key: ssh-ed25519 AAAAC3NzaC1lZDI1NTE5AAAAIOPkT2llJaO+zonEbS8vdL3lhWnQ4gj9fIxwPAsuwdxp github-actions-deploy
          port: 22
          script: |
            cd /root/proyect
            sudo docker-compose down || true
            sudo docker-compose up -d --build
